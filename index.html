<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Generator ⚽</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style for the drop zones */
        .drop-zone {
            min-height: 200px;
            transition: background-color 0.2s ease;
        }
        /* Style for a card being dragged */
        .dragging {
            opacity: 0.5;
            transform: rotate(3deg);
        }
        /* Style for a drop zone being dragged over */
        .drag-over {
            border-style: dashed;
        }
        /* Position the action buttons */
        .player-card {
            position: relative;
        }
        .card-action-button {
            position: absolute;
            top: 2px;
            left: 4px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-center text-blue-700">Team Generator ⚽</h1>
            <p class="text-center text-lg text-gray-600 mt-2">Add players, sort them by position, and generate balanced teams.</p>
        </header>

        <!-- Player Input Section -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <label for="player-names" class="block text-lg font-medium text-gray-700 mb-2">Enter Player Names (comma-separated)</label>
            <textarea id="player-names" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g. Alex, Jordan, Sam, Taylor, Morgan..."></textarea>
            <button id="load-roster-btn" class="mt-4 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition duration-200">Add Players</button>
        </div>

        <!-- Feedback Message Box -->
        <div id="feedback-message" class="hidden p-4 rounded-lg mb-6 text-center font-medium"></div>

        <!-- Reset Button -->
        <div class="flex justify-center mb-6 gap-4">
            <button id="clear-positions-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium transition-colors">
                Clear All Positions
            </button>
        </div>

        <!-- Sorting Area: Positions -->
        <div id="position-sorter" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <!-- Roster Column -->
            <div class="bg-gray-100 p-4 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-center text-gray-700 mb-4">Roster</h2>
                <div id="roster-list-position" data-category="roster" class="drop-zone bg-gray-200 p-3 rounded-lg border-2 border-gray-300"></div>
            </div>
            <!-- Defender Column -->
            <div class="bg-green-50 p-4 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-center text-green-800 mb-4">Defenders</h2>
                <div id="defender-list" data-category="position" data-value="defender" class="drop-zone bg-green-100 p-3 rounded-lg border-2 border-green-200 drag-over:bg-green-200"></div>
            </div>
            <!-- Midfielder Column -->
            <div class="bg-yellow-50 p-4 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-center text-yellow-800 mb-4">Midfielders</h2>
                <div id="midfielder-list" data-category="position" data-value="midfielder" class="drop-zone bg-yellow-100 p-3 rounded-lg border-2 border-yellow-200 drag-over:bg-yellow-200"></div>
            </div>
            <!-- Attacker Column -->
            <div class="bg-red-50 p-4 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-center text-red-800 mb-4">Attackers</h2>
                <div id="attacker-list" data-category="position" data-value="attacker" class="drop-zone bg-red-100 p-3 rounded-lg border-2 border-red-200 drag-over:bg-red-200"></div>
            </div>
        </div>

        <!-- Team Generation Section -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8 flex flex-col sm:flex-row items-center justify-center gap-4">
            <div>
                <label for="num-teams" class="text-lg font-medium text-gray-700 mr-2">Number of Teams:</label>
                <input type="number" id="num-teams" value="2" min="2" class="w-20 p-2 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-blue-500">
            </div>
            <button id="generate-btn" class="px-8 py-3 bg-green-600 text-white font-bold rounded-lg shadow hover:bg-green-700 transition duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                Generate Teams
            </button>
        </div>

        <!-- Generated Teams Output -->
        <div id="teams-output" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Generated teams will be displayed here -->
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Global State ---
            let players = {}; // Central store for player data
            let draggingCard = null;

            // --- Element References ---
            const loadRosterBtn = document.getElementById('load-roster-btn');
            const generateBtn = document.getElementById('generate-btn');
            const rosterListPosition = document.getElementById('roster-list-position');
            const dropZones = document.querySelectorAll('.drop-zone');
            const clearPositionsBtn = document.getElementById('clear-positions-btn');

            // --- 1. Load Roster ---
            loadRosterBtn.addEventListener('click', () => {
                const playerNamesInput = document.getElementById('player-names');
                const names = playerNamesInput.value.split(',')
                    .map(name => name.trim())
                    .filter(name => name.length > 0);

                if (names.length === 0) {
                    showFeedback('Please enter at least one player name.', 'error');
                    return;
                }

                names.forEach((name, index) => {
                    const playerId = `player-${Date.now()}-${index}`;
                    
                    const cardPosition = createPlayerCard(name, playerId);

                    // Store player data
                    players[playerId] = {
                        id: playerId,
                        name: name,
                        position: null,
                        cardPosElement: cardPosition
                    };

                    rosterListPosition.appendChild(cardPosition);
                    updateCardButtons(cardPosition, 'roster-list-position');
                });

                playerNamesInput.value = ''; // Clear input
                checkButtonState();
                showFeedback(`Added ${names.length} new players. Sort them by position.`, 'success');
            });

            // --- 2. Reset Button Listener ---
            clearPositionsBtn.addEventListener('click', () => {
                for (const playerId in players) {
                    const player = players[playerId];
                    if (player.position) { // If they have a position assigned
                        player.position = null; // Reset it
                        rosterListPosition.appendChild(player.cardPosElement); // Move card
                        updateCardButtons(player.cardPosElement, 'roster-list-position'); // Update buttons
                    }
                }
                checkButtonState(); // Check generate button
                showFeedback('All positions cleared. Players returned to roster.', 'success');
            });

            // --- 3. Create Player Card ---
            function createPlayerCard(name, playerId) {
                const card = document.createElement('div');
                card.id = `pos-${playerId}`;
                card.dataset.playerId = playerId; // Link to the central player store
                card.className = 'player-card bg-white p-3 rounded-lg shadow my-2 flex items-center justify-between';

                // Player Name
                const nameSpan = document.createElement('span');
                nameSpan.className = 'player-name font-medium text-gray-800 cursor-move flex-grow pl-6 text-sm min-w-0 overflow-hidden whitespace-nowrap text-ellipsis';
                nameSpan.textContent = name;
                nameSpan.draggable = true;
                
                nameSpan.addEventListener('dragstart', (e) => {
                    draggingCard = card; 
                    e.dataTransfer.setData('text/plain', card.id);
                    e.dataTransfer.setData('player-id', playerId);
                    setTimeout(() => card.classList.add('dragging'), 0);
                });
                
                nameSpan.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                    draggingCard = null;
                    checkButtonState();
                });

                card.appendChild(nameSpan);

                // Button Container for D/M/A
                const btnContainer = document.createElement('div');
                btnContainer.className = 'dma-buttons flex gap-1.5 ml-2';
                
                btnContainer.appendChild(createMoveButton('D', 'bg-green-600', 'defender-list', card));
                btnContainer.appendChild(createMoveButton('M', 'bg-yellow-600', 'midfielder-list', card));
                btnContainer.appendChild(createMoveButton('A', 'bg-red-600', 'attacker-list', card));
                card.appendChild(btnContainer);

                <!-- Return to Roster button (Grey X) -->
                card.appendChild(createReturnToRosterButton(card));
                // Delete button (Red X)
                card.appendChild(createDeleteButton(card));

                return card;
            }

            // --- 3b. Helper to create move buttons (D/M/A) ---
            function createMoveButton(text, bgColor, targetListId, card) {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.textContent = text;
                btn.className = `${bgColor} text-white w-6 h-6 rounded-full text-xs font-bold flex items-center justify-center hover:opacity-80 transition-opacity flex-shrink-0`;
                
                btn.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    const targetList = document.getElementById(targetListId);
                    if (targetList) {
                        targetList.appendChild(card);
                        const playerId = card.dataset.playerId;
                        players[playerId].position = targetList.dataset.value;
                        updateCardButtons(card, targetListId); 
                        checkButtonState(); 
                    }
                });
                return btn;
            }

            // --- 3c. Helper to create Return-to-Roster button (Grey X) ---
            function createReturnToRosterButton(card) {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.innerHTML = '&times;'; // 'X' symbol
                btn.className = 'card-action-button return-button text-gray-500 hover:text-gray-800 font-bold text-lg w-6 h-6 rounded-full flex items-center justify-center transition-colors';
                
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const playerId = card.dataset.playerId;
                    
                    rosterListPosition.appendChild(card);
                    players[playerId].position = null;
                    updateCardButtons(card, 'roster-list-position'); 
                    
                    checkButtonState(); 
                });
                return btn;
            }
            
            // --- 3d. Helper to create Delete button (Red X) ---
            function createDeleteButton(card) {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.innerHTML = '&times;'; // 'X' symbol
                btn.className = 'card-action-button delete-button text-red-400 hover:text-red-700 font-bold text-lg w-6 h-6 rounded-full flex items-center justify-center transition-colors';
                
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const playerId = card.dataset.playerId;
                    const playerData = players[playerId];
                    
                    // Remove card and player data
                    if (playerData) {
                        playerData.cardPosElement.remove();
                        delete players[playerId];
                    }
                    checkButtonState();
                });
                return btn;
            }

            // --- 3e. Helper to toggle button visibility ---
            function updateCardButtons(card, parentListId) {
                const dmaContainer = card.querySelector('.dma-buttons');
                const returnButton = card.querySelector('.return-button');
                const deleteButton = card.querySelector('.delete-button');

                if (!dmaContainer || !returnButton || !deleteButton) return;

                const isRoster = parentListId === 'roster-list-position';

                if (isRoster) {
                    dmaContainer.classList.remove('hidden');
                    deleteButton.classList.remove('hidden');
                    returnButton.classList.add('hidden');
                } else {
                    dmaContainer.classList.add('hidden');
                    deleteButton.classList.add('hidden');
                    returnButton.classList.remove('hidden');
                }
            }

            // --- 4. Drag and Drop Handlers ---
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });

            function handleDragOver(e) {
                e.preventDefault(); 
                // Allow dropping in any category zone or the roster
                this.classList.add('drag-over');
            }

            function handleDragLeave(e) {
                this.classList.remove('drag-over');
            }

            function handleDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                if (!draggingCard) return;

                const playerId = draggingCard.dataset.playerId;
                const zoneCategory = this.dataset.category;
                const zoneValue = this.dataset.value;

                if (zoneCategory === 'position') {
                    // Dropped in a category (e.g., Defenders)
                    this.appendChild(draggingCard);
                    players[playerId].position = zoneValue; // Update player data
                    updateCardButtons(draggingCard, this.id);
                } else if (zoneCategory === 'roster') {
                    // Dropped back in position roster
                    this.appendChild(draggingCard);
                    players[playerId].position = null;
                    updateCardButtons(draggingCard, this.id);
                }
                
                checkButtonState();
            }

            // --- 5. Check Button State ---
            function checkButtonState() {
                const rosterPositionEmpty = rosterListPosition.children.length === 0;
                const playersExist = Object.keys(players).length > 0;

                // Enable button only if the position roster is empty AND at least one player exists
                generateBtn.disabled = !(rosterPositionEmpty && playersExist);
            }

            // --- 6. Generate Teams ---
            generateBtn.addEventListener('click', handleGenerateTeams);

            function handleGenerateTeams() {
                const numTeamsInput = document.getElementById('num-teams');
                const numTeams = parseInt(numTeamsInput.value, 10);

                if (isNaN(numTeams) || numTeams < 2) {
                    showFeedback('Please enter a valid number of teams (at least 2).', 'error');
                    return;
                }
                
                if (numTeams > Object.keys(players).length) {
                    showFeedback('Cannot create more teams than available players.', 'error');
                    return;
                }

                // Create 3 pots for distribution
                const pots = {
                    'defender': [], 
                    'midfielder': [],
                    'attacker': []
                };

                // Sort players into the 3 pots
                for (const id in players) {
                    const p = players[id];
                    // Button is active, so we can assume p.position exists
                    if (p.position && pots[p.position]) { 
                        pots[p.position].push(p.name);
                    }
                }
                
                // Distribute each pot
                const teamPots = {};
                for (const potKey in pots) {
                    teamPots[potKey] = distributePlayers(pots[potKey], numTeams);
                }

                // Combine into final teams
                const finalTeams = Array.from({ length: numTeams }, (_, i) => {
                    const team = { team: i + 1 };
                    // Collect all players for this team from the distributed pots
                    team.defenders = teamPots['defender'][i];
                    team.midfielders = teamPots['midfielder'][i];
                    team.attackers = teamPots['attacker'][i];
                    return team;
                });

                displayTeams(finalTeams);
            }

            /** Shuffles an array in place. */
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            /** Distributes players into teams using a snake draft for balance. */
            function distributePlayers(players, numTeams) {
                const teams = Array.from({ length: numTeams }, () => []);
                let teamIndex = 0;
                let direction = 1; 
                const shuffledPlayers = shuffle([...players]); 

                shuffledPlayers.forEach(player => {
                    teams[teamIndex].push(player);
                    teamIndex += direction;

                    if (teamIndex === numTeams) {
                        teamIndex = numTeams - 1;
                        direction = -1;
                    } else if (teamIndex < 0) {
                        teamIndex = 0;
                        direction = 1;
                    }
                });
                return teams;
            }

            // --- 7. Display Teams ---
            function displayTeams(teams) {
                const container = document.getElementById('teams-output');
                container.innerHTML = ''; 

                if (teams.length === 0) return;
                
                showFeedback(`Successfully generated ${teams.length} balanced teams!`, 'success');

                teams.forEach(team => {
                    const teamCard = document.createElement('div');
                    teamCard.className = 'bg-white p-6 rounded-lg shadow-lg mb-4';
                    
                    let html = `<h3 class="text-2xl font-bold text-blue-700 mb-4">Team ${team.team}</h3>`;
                    
                    const totalPlayers = team.defenders.length + team.midfielders.length + team.attackers.length;
                    html += `<p class="text-sm text-gray-600 mb-3 font-semibold">Total Players: ${totalPlayers}</p>`;
                    
                    if (team.defenders.length > 0) {
                        html += `<div class="mb-2"><strong class="text-green-700">Defenders:</strong> ${shuffle(team.defenders).join(', ')}</div>`;
                    }
                    if (team.midfielders.length > 0) {
                        html += `<div class="mb-2"><strong class="text-yellow-700">Midfielders:</strong> ${shuffle(team.midfielders).join(', ')}</div>`;
                    }
                    if (team.attackers.length > 0) {
                        html += `<div class="mb-2"><strong class="text-red-700">Attackers:</strong> ${shuffle(team.attackers).join(', ')}</div>`;
                    }
                    if (totalPlayers === 0) {
                        html += `<p class="text-gray-500">No players assigned to this team.</p>`;
                    }

                    teamCard.innerHTML = html;
                    container.appendChild(teamCard);
                });
            }

            // --- 8. Feedback Utility ---
            function showFeedback(message, type = 'success') {
                const feedbackBox = document.getElementById('feedback-message');
                feedbackBox.textContent = message;
                
                feedbackBox.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');
                
                if (type === 'error') {
                    feedbackBox.classList.add('bg-red-100', 'text-red-700');
                } else {
                    feedbackBox.classList.add('bg-green-100', 'text-green-700');
                }
                
                setTimeout(() => {
                    feedbackBox.classList.add('hidden');
                }, 3000);
            }
            
            // Initial check
            checkButtonState();
        });
    </script>
</body>
</html>

